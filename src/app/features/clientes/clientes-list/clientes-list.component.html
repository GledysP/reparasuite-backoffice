<div class="rs-page-container">
  <div class="rs-header">
    <h2 class="rs-page-title">Customers</h2>
  </div>

  <mat-card class="search-card rs-card-white">
    <mat-card-content>
      <form [formGroup]="form">
        <mat-form-field appearance="outline" class="rs-search-field">
          <mat-icon matPrefix>search</mat-icon>
          <input matInput formControlName="query" placeholder="Buscar por nombre, teléfono o email" />
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="table-card rs-card-white">
    <mat-card-content class="no-padding">
      <div class="rs-table-full-width">
        <div class="table-responsive">
          <table mat-table [dataSource]="items" class="rs-table">
            
            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef> Customer </th>
              <td mat-cell *matCellDef="let row" class="fw-bold"> {{ row.nombre }} </td>
            </ng-container>

            <ng-container matColumnDef="telefono">
              <th mat-header-cell *matHeaderCellDef> Phone </th>
              <td mat-cell *matCellDef="let row"> {{ row.telefono || '—' }} </td>
            </ng-container>

            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef> Email </th>
              <td mat-cell *matCellDef="let row" class="text-muted"> {{ row.email || '—' }} </td>
            </ng-container>

            <ng-container matColumnDef="totalWos">
              <th mat-header-cell *matHeaderCellDef class="cell-center"> Total WOs </th>
              <td mat-cell *matCellDef="let row" class="cell-center"> {{ row.totalWos ?? 0 }} </td>
            </ng-container>

            <ng-container matColumnDef="lastWoDate">
              <th mat-header-cell *matHeaderCellDef class="cell-center"> Last WO Date </th>
              <td mat-cell *matCellDef="let row" class="cell-center"> {{ (row.lastWoDate | date:'yyyy-MM-dd') || '—' }} </td>
            </ng-container>

            <ng-container matColumnDef="accion">
              <th mat-header-cell *matHeaderCellDef class="cell-right"> Action </th>
              <td mat-cell *matCellDef="let row" class="cell-right">
                <div class="action-btns">
                  <button mat-icon-button [routerLink]="['/clientes', row.id]" class="rs-btn-action">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button (click)="eliminar(row)" class="del-btn">
                    <mat-icon>delete_outline</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="rs-table-row"></tr>
          </table>
        </div>
      </div>

      <mat-paginator
        class="rs-custom-paginator"
        [length]="total"
        [pageIndex]="page"
        [pageSize]="size"
        [pageSizeOptions]="[10, 20, 50]"
        (page)="paginar($event)">
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>